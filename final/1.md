# Containers

## Prática

* No terminal, execute o comando `docker run` , conforme o exemplo abaixo:

```bash 
docker run ubuntu
```

* Como a imagem não está disponível localmente, o __Docker__ vai obtê-la no __Docker Hub__.

```console
Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
dafa2b0c44d2: Download complete
Digest: sha256:dfc10878be8d8fc9c61cbff33166cb1d1fe44391539243703c72766894fa834a
Status: Downloaded newer image for ubuntu:latest
```

* Execute o comando `docker ps`, para verificar os containers em execução.

```bash
docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES

```

* Como a imagem `ubuntu` não tem nenhum processo associado a ela, o container termina sua exeucução. Essa é uma diferença fundamental entre o ciclo de vida de um container e uma máquina virtual.

* Em seguida, execute o comando `docker ps -a`, para verificar os containers, inclusive aqueles que terminaram de executar.

```bash
docker ps -a
```

```console
CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS                     PORTS     NAMES
6348c66c0df7   ubuntu    "/bin/bash"   3 seconds ago   Exited (0) 2 seconds ago             condescending_mclaren
```

* Para manter o container em execução, podemos fornecer um comando a ele.

```bash
docker run ubuntu sleep 5
```

* Perceba que o terminal ficou bloqueado até o fim da execução do comando. Para evitar que isso acontece, podemos executar o comando no modo _detached_ , por meio do parâmetro `-d`.

```bash
docker run -d ubuntu sleep 30
```

* Para verificar se o container ainda está em execução, use o comando `docker ps`

```bash
docker ps
CONTAINER ID   IMAGE     COMMAND      CREATED         STATUS         PORTS     NAMES
80634a9c6254   ubuntu    "sleep 30"   4 seconds ago   Up 3 seconds             silly_morse
```

* Aguarde os 30 segundos e execute o comando `docker ps` novamente.

```bash
docker ps
CONTAINER ID   IMAGE     COMMAND      CREATED         STATUS         PORTS     NAMES

```

* Para manter o container em execução, podemos conectar nosso terminal ao terminal do container, executando-o no modo iterativo. Veja o exemplo abaixo:

```bash
docker run -it ubuntu bash
root@870a80757d7a:/# 
```


* Esse comando instancia um container com a imagem __ubuntu__. O parâmetro `-it` associa nosso terminal ao processo `bash`. Dessa forma, a execução não termina, até que o comando `exit` seja executado no __bash shell__.

* Abra um outro terminal e execute o comando `docker ps`

```bash
docker ps
```

```console
CONTAINER ID   IMAGE     COMMAND   CREATED              STATUS
   PORTS     NAMES
10afaa457875   ubuntu    "bash"    About a minute ago   Up About a minute             optimistic_ptolemy
```

* Perceba que agora o __STATUS__ do container está com o estado __Up__.

* No __bash shell__ do container, execute o comando `ls`, para obter os arquivos e diretórios do diretório atual.

```bash
root@cf58e1e8582f:/# ls
```

```console
bin   dev  home  lib64  mnt  proc  run   srv  tmp  var
boot  etc  lib   media  opt  root  sbin  sys  usr
```

* Para obter o conteúdo de um dos diretórios listados acima, como o __bin__ por exemplo, no __bash shell__, execute o comando `ls bin`

```bash
root@cf58e1e8582f:/# ls bin
```

```console
'[                        hostid             savelog
addpart                   hostname           script
apt                       i386               scriptlive
apt-cache                 iconv              scriptreplay
apt-cdrom                 id                 sdiff
apt-config                infocmp            sed
apt-get                   infotocap          select-editor
apt-key                   install            sensible-browser
apt-mark                  ionice             sensible-editor
...
```

* Execute o comando `echo 'hello-world'`

```bash
root@cf58e1e8582f:/# echo 'hello-world'
```

```console
hello-world
```

* Como __echo__ é um executável disponível na imagem __ubuntu__, é possível executá-lo por meio do __bash shell__ dentro desse container.

* Execute também os comandos `hostname` e `hostname -i` no __bash shell__ do container.

```bash
root@cf58e1e8582f:/# hostname
```

```console
cf58e1e8582f
```

```bash
root@cf58e1e8582f:/# hostname -i
```

```console
172.17.0.2
```

* O primeiro comando mostra a identificação do container; o segundo, o endereço de IP.

* No __bash shell__ do container, execute o comando `exit`.

```bash
root@10afaa457875:/# exit
```

```console
exit
```

* Agora, execute novamente o comando `docker ps -a`.

```bash
docker ps -a
```

```console
CONTAINER ID   IMAGE     COMMAND       CREATED              STATUS
              PORTS     NAMES
6bc81af08914   ubuntu    "bash"        6 seconds ago        Exited (0) 4 seconds ago                  unruffled_hypatia
e1ea0794c5d2   ubuntu    "/bin/bash"   About a minute ago   Exited (0) About a minute ago             priceless_chebyshev
```

> O comando `docker container ls` tem o mesmo efeito que o comando `docker ps`

## Containers em segundo plano

* Se o container foi criado em segundo plano (modo _detached_), use o comando `attach`, para conectar ao seu terminal

```bash
docker run -d nginx
6f03e682c2d591bd01a193850e568838f1495a0b9104618143c8a27c7a47d9a3

docker ps
CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES
6f03e682c2d5   nginx     "/docker-entrypoint.…"   3 seconds ago   Up 2 seconds   80/tcp    admiring_chatelet

docker attach 6f03
_
```

* Embora pareça travado, nosso terminal está conectado com o do container. Utilize as teclas `CTRL + C` para enviar um sinal do tipo `SIGINT` e terminar a execução do servidor _nginx_
* Em seguida, execute o comando `docker ps` para verificar se ele foi terminado corretamente.

```bash
docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES

```

* Como o container estava associado ao processo do servidor _nginx_, ao terminá-lo, a execução do container também foi encerrada.

## Prática 2

* É possível criar um novo processo dentro de um container em execução. Para isso, usamos o comando `docker exec`.

1. Crie um container com a imagem `ubuntu`, no modo iterativo. 
1. Dentro do terminal desse container, execute o comando `ps aux`, para listar os processos em execução.
1. Em seguida, em outro terminal execute o comando `docker exec`, para criar um processo do tipo `bash` dentro do container criado anteriormente.
1. Dentro do novo `bash shell` criado, execute o comando `ps aux` novamente.

```bash
#terminal 1
docker run -it ubuntu bash
root@d99e3739475b:/# ps aux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.1   4588  3968 pts/0    Ss   13:08   0:00 bash
root         9  0.0  0.1   7888  3968 pts/0    R+   13:09   0:00 ps aux
```

```bash
#terminal 2
docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED              STATUS              PORTS     NAMES
d99e3739475b   ubuntu    "bash"    About a minute ago   Up About a minute             lucid_meninsky

docker exec -it d99e bash
root@d99e3739475b:/# ps aux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.1   4588  3968 pts/0    Ss+  13:08   0:00 bash
root        10  0.0  0.1   4588  3840 pts/1    Ss   13:10   0:00 bash
root        18  0.0  0.1   7888  4096 pts/1    R+   13:11   0:00 ps aux
```

> Para parar a execução desse container a partir do terminal dele, execute o comando `exit`.
>
> Outra forma de parar a execução desse container é por meio de um terminal do próprio _host_, com o comando `docker stop`.

```bash
docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED              STATUS              PORTS     NAMES
d99e3739475b   ubuntu    "bash"    About a minute ago   Up About a minute             lucid_meninsky

docker stop d99e
d99e
```

